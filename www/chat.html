<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/splash/splash-icon.png">
    <link rel="apple-touch-startup-image" href="images/splash/splash-screen.png" media="screen and (max-device-width: 320px)" />
    <link rel="apple-touch-startup-image" href="images/splash/splash-screen@2x.png" media="(max-device-width: 480px) and (-webkit-min-device-pixel-ratio: 2)" />
    <link rel="apple-touch-startup-image" sizes="640x1096" href="images/splash/splash-screen@3x.png" />

    <title>LetzChat - Version 1.0a</title>

    <link href="styles/style.css" rel="stylesheet" type="text/css">
    <link href="styles/menus-background.css" rel="stylesheet" type="text/css" id="pagestyle">
    <link href="styles/framework.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.carousel.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.theme.css" rel="stylesheet" type="text/css">
    <link href="styles/swipebox.css" rel="stylesheet" type="text/css">
    <link href="styles/colorbox.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="css/chat.css">

    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/jqueryui.js"></script>
    <script type="text/javascript" src="scripts/owl.carousel.min.js"></script>
    <script type="text/javascript" src="scripts/jquery.swipebox.js"></script>
    <script type="text/javascript" src="scripts/colorbox.js"></script>
    <script type="text/javascript" src="scripts/snap.js"></script>
    <script type="text/javascript" src="scripts/contact.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>
    <script type="text/javascript" src="scripts/framework.js"></script>
    <script type="text/javascript" src="scripts/framework.launcher.js"></script>

    <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-storage.js"></script>
    <script type="text/javascript" src="scripts/firebaseUtils.js"></script>

    <script type="text/javascript">
        function swapStyleSheet(sheet) {
            document.getElementById('pagestyle').setAttribute('href', sheet);
        }
    </script>

    


    <script type="text/javascript">
        var current_page = window.location.href;
        var url = new URL(current_page);
        var convoid = url.searchParams.get("conversation_id");
        var user_id = localStorage.getItem("userId");
        var conversation_id = convoid;
        var messageRef = firebase.database().ref('messages/');

        //
        //  A lot easier to compare milliseconds from UNIX Time
        //  NOTE: use Date.parse() to display something humanly readable
        //
        //var dateTime = Date.now();
        
        var language = localStorage.getItem("device_language");

        if ((navigator.platorm) == "Win32" || "MacIntel") {

            language = navigator.language;

        }

        var text = "";
        var $ = jQuery.noConflict();
        var messageForm = document.getElementById('messageForm');

        function onMessageSubmitted() {

            var dateTime = Date.now();

            //console.log("function called");
            text = document.getElementById('message').value;

            //
            //  Empty the Text box
            //
            document.getElementById('message').value = "";

            //console.log("testing code ", localStorage.getItem("device_language"));
            //console.log("the time is " + dateTime);
            //console.log("the language is " + language);
            //console.log("the message is " + text);

           
            //
            //  Sanitize inputs
            //
            if (language == null) {

                language = "";

            }

            if (!conversation_id) {
                conversation_id = "";
            }
            if (!dateTime) {
                dateTime = "";
            }
            if (!text) {
                text = "";
            }
            if (!user_id) {
                user_id = "";
            }

            messageRef.push({
                conversation_id: conversation_id,
                dateTime: dateTime,
                language: language,
                text: text,
                user_id: user_id
            });

            return false;

        }
    </script>


</head>
<body>



    <div id="preloader">
        <div id="status">
            <p class="center-text">
                Loading the content...
                <em>Loading depends on your connection speed!</em>
            </p>
        </div>
    </div>



    <div class="clear"></div>

    <div class="all-elements">
        <div class="content-header">
            <!-- Activate the side nav button if necessary -->
            <a href="#" class="deploy-sidebar"></a>
            <img class="logo" style="margin-top: -50px;" src="images/misc/letzchat_logo_white.png" width="92" alt="img">
            <a href="startconversation.html" class="deploy-contact"></a>
            <div class="clear"></div>
        </div>

        <!-- Include the side nav if necessary -->
        <div data-include="side-nav"></div>


        <div id="content" class="page-content">

            <div class="content">

                <div class="decoration"></div>

                <div class="container">
                   
                    <ol id="chat_window" class="chat">
                        <li>

                            <img src="images/logo.png"/>

                        </li>
                      
                    </ol>
                    <form onsubmit="return onMessageSubmitted()" id="messageForm" method="post">
                        <input id="message" type="text" name="message" class="textarea" placeholder="Type here!" /><div class="emojis"></div>
                        <input type="hidden" onkeydown="if (event.keyCode == 13) { this.form.submit()}" name="" value="">
                    </form>
                </div>

                <div class="decoration"></div>


                <div style="height:60px"></div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="cordova.js"></script>
   
    <script type="text/javascript" src="scripts/platformOverrides.js"></script>
    <script type="text/javascript" src="scripts/hexagon.js"></script>

</body>
</html>
